<div class="flex flex-column main">
  <div class="flex flex-row align-items-center justify-content-between ml-3">
    <h1>{{ $sidebar() }}</h1>
    <div class="flex flex-row align-items-center mr-3">
      <p-avatarGroup class="mr-3">
        <p-avatar image="assets/img/icon1.png" size="large" shape="circle" />
        <p-avatar image="assets/img/icon2.jpg" size="large" shape="circle" />
        <p-avatar label="M" shape="circle" size="large"></p-avatar>
        <p-avatar label="N" shape="circle" size="large"></p-avatar>
        <p-avatar label="K" shape="circle" size="large"></p-avatar>
      </p-avatarGroup>
      <p-button
        label="invite"
        icon="pi pi-plus"
        [rounded]="true"
        severity="contrast"
      ></p-button>
    </div>
  </div>

  @if ($isLoading()) {
    <div
      style="display: grid; place-items: center; height: calc(100vh - 2.5rem)"
    >
      <p-progressSpinner></p-progressSpinner>
    </div>
  } @else {
    <div class="dashboard h-full">
      @for (item of status; let i = $index; track i) {
        <div>
          <div
            class="mx-2 flex flex-row align-items-center justify-content-between"
          >
            <div class="flex flex-row align-items-center">
              <h3 class="mr-3">{{ item }}</h3>
              <div
                class="border-round-2xl border-1 px-3 font-semibold opacity-60"
              >
                {{ this.$data()[$sidebar()].tasks[item].length }}
              </div>
            </div>
            <i
              class="pi pi-plus text-xl opacity-80 cursor-pointer"
              (click)="onClickAddTask(item)"
            ></i>
          </div>
          <div
            class="custom-divider"
            [style.border-color]="statusStyle[item].mainColor"
          ></div>

          <div
            class="border-round-xl overflow-y-scroll"
            [style.background-color]="'var(--surface-border)'"
          >
            @for (
              task of $data()[$sidebar()].tasks[item];
              let i = $index;
              track i
            ) {
              <div
                class="border-300 bg-white border-round-2xl p-2 m-2"
                (click)="onClickTask(task)"
              >
                <p-tag
                  styleClass="font-semibold text-white"
                  [style]="{
                    background:
                      'linear-gradient(to right,' +
                      statusStyle[item].leftColor +
                      ',' +
                      statusStyle[item].leftColor,
                    color: 'black',
                  }"
                  [value]="task.status"
                ></p-tag>
                <h3>{{ task.title }}</h3>
                <p class="opacity-60">{{ task.description }}</p>
                @if (item !== "todo") {
                  <div class="mb-2">
                    <div
                      class="flex flex-row justify-content-between align-items-center"
                    >
                      <p class="font-semibold text-color-secondary">Progress</p>
                      <p class="font-semibold text-color-secondary">
                        {{ task.progress }}/100
                      </p>
                    </div>
                    <p-progressBar
                      [value]="task.progress"
                      [color]="
                        task.progress !== '100'
                          ? statusStyle[item].mainColor
                          : 'var(--green-400)'
                      "
                      [style]="{
                        height: '0.425rem',
                      }"
                      (click)="onClickUpdateProgressBar($event, item, i)"
                    >
                      <ng-template pTemplate="content" let-value> </ng-template>
                    </p-progressBar>
                  </div>
                }
                <p-divider></p-divider>
                <div class="grid">
                  <p-avatarGroup class="col-4 m-0">
                    <p-avatar
                      [style]="{ width: '2.5rem', height: '2.5rem' }"
                      image="assets/img/icon1.png"
                      shape="circle"
                    />
                    <p-avatar
                      [style]="{ width: '2.5rem', height: '2.5rem' }"
                      image="assets/img/icon2.jpg"
                      shape="circle"
                    />
                  </p-avatarGroup>
                  <div
                    class="col-8 flex align-items-center justify-content-end gap-2 m-0"
                  >
                    @for (tag of status; let i = $index; track i) {
                      @if (tag !== item) {
                        <p-tag
                          [value]="tag"
                          [style]="{ background: statusStyle[tag].mainColor }"
                        ></p-tag>
                      }
                    }
                  </div>
                </div>
              </div>
            }
          </div>
        </div>
      }
      <!--    全体のタイムライン   -->
      <div>
        <div
          class="mx-2 flex flex-row align-items-center justify-content-between"
        >
          <div class="flex flex-row align-items-center">
            <h3 class="mr-3">SCHEDULE</h3>
          </div>
        </div>
      </div>
    </div>
  }
</div>

<p-sidebar
  class="custom-p-sidebar"
  [(visible)]="sidebarTask.visible"
  transitionOptions="350ms cubic-bezier(0, 0, 0.2, 1)"
  position="right"
  styleClass="w-30rem border-round-3xl"
>
  <div class="flex align-items-center justify-content-between w-full">
    <h1>{{ sidebarTask.task?.title }}</h1>
    <p-avatarGroup class="mr-3">
      <p-avatar image="assets/img/icon1.png" size="large" shape="circle" />
      <p-avatar image="assets/img/icon2.jpg" size="large" shape="circle" />
      <p-avatar label="M" shape="circle" size="large"></p-avatar>
    </p-avatarGroup>
  </div>
  <h4>{{ sidebarTask.task?.description }}</h4>
  <p-divider></p-divider>
  <!--  timeline-->
  <div class="w-full flex justify-content-center align-items-start flex-column">
    <div class="w-full flex justify-content-between align-items-center">
      <h2>Timeline</h2>
      <i class="pi pi-plus text-xl opacity-80 cursor-pointer"></i>
    </div>
    <!--    <p-timeline-->
    <!--      class="w-full custom-p-timeline"-->
    <!--      [value]="sidebarTask.task?.timeline"-->
    <!--    >-->
    <!--      <ng-template pTemplate="marker" let-value>-->
    <!--        <span-->
    <!--          class="flex w-2rem h-2rem align-items-center justify-content-center text-white border-circle z-1 shadow-1"-->
    <!--          [style]="{-->
    <!--            'background-color':-->
    <!--              value.status === 'done'-->
    <!--                ? 'var(&#45;&#45;green-600)'-->
    <!--                : 'var(&#45;&#45;surface-border)',-->
    <!--          }"-->
    <!--        >-->
    <!--          <i class="pi pi-check-circle"></i>-->
    <!--        </span>-->
    <!--      </ng-template>-->
    <!--      <ng-template pTemplate="content" let-event>-->
    <!--        <div class="flex flex-row align-items-start justify-content-between">-->
    <!--          <p class="font-semibold m-1">{{ event.comment }}</p>-->
    <!--          <small class="m-2">{{-->
    <!--            event.createdAt | date: "yyyy/MM/dd HH:mm"-->
    <!--          }}</small>-->
    <!--        </div>-->
    <!--      </ng-template>-->
    <!--    </p-timeline>-->
  </div>
</p-sidebar>
